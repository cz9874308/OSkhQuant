# 第 5 课：数据管理

> ⏱ **课时**：25 分钟  
> 🎯 **学习目标**：掌握数据中心的使用，理解数据周期和复权方式  
> 📚 **难度**：⭐⭐ 入门级

---

## 📖 课程概览

俗话说，"巧妇难为无米之炊"。对于量化策略来说，**数据就是"米"**。

没有数据，再好的策略也跑不起来。今天我们就来学习如何管理和获取数据。

---

## 5.1 数据在量化交易中的角色

### 为什么数据这么重要？

```mermaid
graph LR
    A[历史数据] --> B[策略计算指标]
    B --> C[判断买卖信号]
    C --> D[模拟交易]
    D --> E[回测结果]
```

策略的每一步都依赖数据。如果数据不全或质量差，结果就会不准确。

### OSkhQuant 的数据来源

OSkhQuant 的数据来自 **MiniQMT**，通过 `xtquant` 库获取。

```
券商服务器 → MiniQMT → xtquant → OSkhQuant → 你的策略
```

---

## 5.2 数据中心概览

点击工具栏的 **"数据"** 按钮，打开数据中心。

### 界面布局

```
┌──────────────────────────────────────────────┐
│               数据中心                        │
├──────────────────────────────────────────────┤
│ 股票列表设置                                  │
│ ┌─────────────────────────────────────────┐  │
│ │ ○ 沪深300  ○ 中证500  ● 自选清单         │  │
│ │ [002945.SZ,华林证券      ]               │  │
│ └─────────────────────────────────────────┘  │
├──────────────────────────────────────────────┤
│ 周期类型                                      │
│ ☑ 1分钟  ☐ 5分钟  ☐ 15分钟  ☐ 1日          │
├──────────────────────────────────────────────┤
│ 日期范围                                      │
│ 开始: [2024-01-01]  结束: [2024-12-31]       │
├──────────────────────────────────────────────┤
│ [补充数据]        [下载数据]                  │
└──────────────────────────────────────────────┘
```

---

## 5.3 数据补充 vs 数据下载

数据中心有两个主要功能按钮，它们的作用不同：

### 数据补充

**作用**：将数据下载到 MiniQMT 的内部数据库，供回测使用。

**特点**：
- 数据存在 MiniQMT 内部，非直接可见
- 专门为回测优化，读取速度快
- 策略会自动从这里读取数据

**使用场景**：
- 运行回测前的必要步骤
- 更新历史数据到最新

### 数据下载

**作用**：将数据导出为 CSV 文件，可以用 Excel 等工具打开。

**特点**：
- 生成可读的 `.csv` 文件
- 可以导入其他软件分析
- 不会加速回测，只是导出

**使用场景**：
- 需要在外部工具中分析数据
- 备份数据到本地
- 用 Python/Excel 做自定义分析

### 对比表

| 特性 | 数据补充 | 数据下载 |
|-----|---------|---------|
| 目的 | 回测使用 | 外部分析 |
| 数据位置 | MiniQMT 内部 | CSV 文件 |
| 回测能否使用 | ✅ 能 | ❌ 不能直接用 |
| 能否用 Excel 打开 | ❌ 不能 | ✅ 能 |

> 💡 **新手建议**  
> 如果你只是想运行回测，用 **数据补充** 就够了。

---

## 5.4 数据周期详解

不同的策略需要不同周期的数据。

### 常见数据周期

| 周期 | 含义 | 每天的数据量 | 适用策略 |
|-----|------|------------|---------|
| Tick | 每 3 秒一条 | 数千条 | 高频策略 |
| 1分钟 | 每分钟一根 K 线 | 240 条 | 日内策略 |
| 5分钟 | 每 5 分钟一根 | 48 条 | 日内/短线 |
| 15分钟 | 每 15 分钟一根 | 16 条 | 短线策略 |
| 30分钟 | 每 30 分钟一根 | 8 条 | 波段策略 |
| 1小时 | 每小时一根 | 4 条 | 波段策略 |
| 日线 | 每天一根 | 1 条 | 中长线策略 |

### 如何选择周期？

```
考虑因素：
├── 策略类型
│   ├── 日内策略 → 分钟级
│   └── 波段/趋势策略 → 日线
├── 回测时间跨度
│   ├── 短期（几天） → 分钟级可用
│   └── 长期（几年） → 建议用日线
└── 计算资源
    └── 数据越细 → 计算越慢
```

### 周期选择建议

| 场景 | 推荐周期 |
|-----|---------|
| 学习入门 | 日线 |
| 均线策略 | 日线 |
| 日内交易 | 1分钟/5分钟 |
| 长期回测（1年以上） | 日线 |
| 精细化回测（1个月） | 1分钟 |

---

## 5.5 复权方式详解

股票发生分红、送股时，价格会突然变化。复权就是处理这种价格"跳空"的方法。

### 三种复权方式

#### 1. 不复权

原始价格，不做任何调整。

```
分红前: 20元
分红后: 18元（送了10%股票，除权）
```

**问题**：价格图会出现"断崖"，均线等指标会失真。

#### 2. 前复权（推荐）

以今天的价格为基准，把历史价格向前调整。

```
今天价格: 18元
分红前历史价格: 20元 → 调整为 18元
```

**优点**：最新价格和实际一致，方便看现价。

#### 3. 后复权

以上市价格为基准，把后续价格向后调整。

```
上市价格: 10元
现在价格: 18元 → 调整为更高的价格
```

**优点**：能反映真实的累计收益。

### 复权方式对比

| 方式 | 最新价是否准确 | 历史价是否连续 | 推荐使用 |
|-----|--------------|--------------|---------|
| 不复权 | ✅ | ❌ | 不推荐 |
| 前复权 | ✅ | ✅ | ⭐ 推荐 |
| 后复权 | ❌ | ✅ | 特殊场景 |

> 💡 **新手建议**  
> 使用 **前复权**，这也是大多数策略的默认选择。

---

## 5.6 实操：补充数据

让我们实际操作一遍数据补充的完整流程。

### Step 1：打开数据中心

点击工具栏的"数据"按钮。

### Step 2：设置股票列表

1. 选择"自选清单"
2. 点击编辑按钮
3. 输入股票，格式：`代码.市场,名称`
   ```
   002945.SZ,华林证券
   600519.SH,贵州茅台
   ```
4. 保存

### Step 3：选择周期

勾选需要的周期类型：
- 如果策略用分钟线 → 勾选"1分钟"
- 如果策略用日线计算指标 → 也要勾选"1日"

### Step 4：设置日期范围

确保日期范围覆盖你的回测区间，最好前后各多留几天。

```
回测区间: 2024-04-01 ~ 2024-10-31
数据范围: 2024-03-01 ~ 2024-11-01（留余量）
```

### Step 5：点击"补充数据"

等待进度条完成。下载时间取决于：
- 股票数量
- 日期跨度
- 数据周期（分钟数据比日线数据大很多）

### Step 6：验证

可以通过日志面板查看是否成功。

---

## 5.7 常见数据问题

### Q1：回测结果是 0，没有任何交易？

**最可能的原因**：数据没补充完整。

**检查步骤**：
1. 日期范围是否覆盖回测区间？
2. 周期类型是否选对了？
3. 股票代码格式是否正确？

### Q2：数据补充很慢？

**原因**：分钟数据量大，需要时间。

**建议**：
- 减少股票数量
- 缩短日期范围
- 优先补充日线，分钟按需补充

### Q3：提示数据下载失败？

**可能原因**：
1. MiniQMT 未登录
2. 网络问题
3. 券商服务器维护

**解决**：
1. 检查 MiniQMT 是否正常登录
2. 稍后重试
3. 检查网络连接

### Q4：历史数据能下载多久的？

MiniQMT 有数据范围限制（具体看券商）：

| 周期 | 通常可下载范围 |
|-----|--------------|
| Tick | 最近 1 个月 |
| 1分钟 | 最近 1 年 |
| 日线 | 全部历史 |

---

## 💡 实践任务

### 任务 1：补充数据
- [ ] 打开数据中心
- [ ] 添加 3 只自选股
- [ ] 补充这 3 只股票的日线数据（过去 1 年）
- [ ] 补充这 3 只股票的 1 分钟数据（过去 1 个月）

### 任务 2：下载数据
- [ ] 选择一只股票
- [ ] 点击"下载数据"
- [ ] 找到生成的 CSV 文件
- [ ] 用 Excel 或记事本打开看看内容

### 任务 3：对比复权方式
- [ ] 选择同一只股票
- [ ] 分别用"不复权"和"前复权"下载日线数据
- [ ] 对比两个 CSV 文件中的价格差异

---

## 📌 核心要点总结

今天你学到了：

1. **数据的重要性**：策略的每一步都依赖数据
2. **两种数据操作**：
   - 数据补充 → 供回测使用
   - 数据下载 → 导出 CSV 文件
3. **数据周期选择**：
   - 日内策略 → 分钟级
   - 趋势策略 → 日线
4. **复权方式**：推荐使用前复权
5. **实操流程**：设置股票 → 选周期 → 设日期 → 补充数据

---

## ➡️ 下一课预告

**第 6 课：策略开发入门** ✍️

数据准备好了，下一步就是自己动手写策略！我们将：
- 从零开始编写一个策略
- 学习如何测试和调试策略
- 掌握策略开发的最佳实践

准备好成为策略开发者了吗？下一课见！🚀
