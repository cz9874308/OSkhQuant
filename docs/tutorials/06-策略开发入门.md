# ç¬¬ 6 è¯¾ï¼šç­–ç•¥å¼€å‘å…¥é—¨

> â± **è¯¾æ—¶**ï¼š45 åˆ†é’Ÿ  
> ğŸ¯ **å­¦ä¹ ç›®æ ‡**ï¼šä»é›¶å¼€å§‹ç¼–å†™ä¸€ä¸ªç®€å•çš„é‡åŒ–ç­–ç•¥  
> ğŸ“š **éš¾åº¦**ï¼šâ­â­â­ è¿›é˜¶å…¥é—¨

---

## ğŸ“– è¯¾ç¨‹æ¦‚è§ˆ

å‰é¢å‡ è¯¾æˆ‘ä»¬ä¸€ç›´åœ¨è¿è¡Œåˆ«äººå†™çš„ç­–ç•¥ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬è¦ **è‡ªå·±åŠ¨æ‰‹å†™ä¸€ä¸ªç­–ç•¥**ï¼

åˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬ä¼šä»æœ€ç®€å•çš„å¼€å§‹ï¼Œä¸€æ­¥ä¸€æ­¥æ¥ã€‚

---

## 6.1 ç­–ç•¥å¼€å‘çš„ä¸€èˆ¬æµç¨‹

å†™ç­–ç•¥å°±åƒå†™ä½œæ–‡ï¼Œéœ€è¦å…ˆæœ‰æ€è·¯ï¼Œå†åŠ¨ç¬”ã€‚

### æ ‡å‡†æµç¨‹

```
1. æ˜ç¡®ç­–ç•¥æ€è·¯
   â””â”€â”€ "æˆ‘æƒ³æ ¹æ®ä»€ä¹ˆè§„åˆ™ä¹°å–ï¼Ÿ"
        â†“
2. ç¼–å†™ä»£ç å®ç°
   â””â”€â”€ æŠŠè§„åˆ™ç¿»è¯‘æˆ Python ä»£ç 
        â†“
3. å›æµ‹éªŒè¯
   â””â”€â”€ ç”¨å†å²æ•°æ®æ£€éªŒæ•ˆæœ
        â†“
4. åˆ†æä¼˜åŒ–
   â””â”€â”€ è°ƒæ•´å‚æ•°ã€æ”¹è¿›é€»è¾‘
        â†“
5. é‡å¤ 2-4
   â””â”€â”€ ç›´åˆ°æ»¡æ„ä¸ºæ­¢
```

---

## 6.2 ä»æƒ³æ³•åˆ°ä»£ç ï¼šRSI ç­–ç•¥

è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªæ–°çš„ç­–ç•¥æ€è·¯æ¥ç»ƒä¹ ã€‚

### ç­–ç•¥æ€è·¯

**RSIï¼ˆç›¸å¯¹å¼ºå¼±æŒ‡æ ‡ï¼‰ç­–ç•¥**ï¼š

- RSI ä½äº 30 â†’ è‚¡ç¥¨è¢«"è¶…å–"ï¼Œå¯èƒ½å³å°†åå¼¹ â†’ ä¹°å…¥
- RSI é«˜äº 70 â†’ è‚¡ç¥¨è¢«"è¶…ä¹°"ï¼Œå¯èƒ½å³å°†ä¸‹è·Œ â†’ å–å‡º

### é€šä¿—è§£é‡Š

æŠŠ RSI æƒ³è±¡æˆè‚¡ç¥¨çš„"ä½“æ¸©è®¡"ï¼š

| RSI å€¼ | çŠ¶æ€ | å«ä¹‰ |
|-------|------|------|
| < 30 | ä½çƒ§ï¼ˆè¶…å–ï¼‰ | è·Œå¾—å¤ªå¤šäº†ï¼Œå¯èƒ½è¦æ¶¨å›æ¥ |
| 30-70 | æ­£å¸¸ | ä¸æ¸©ä¸ç« |
| > 70 | é«˜çƒ§ï¼ˆè¶…ä¹°ï¼‰ | æ¶¨å¾—å¤ªå¤šäº†ï¼Œå¯èƒ½è¦è·Œå›æ¥ |

---

## 6.3 åŠ¨æ‰‹å†™ç­–ç•¥

### Step 1ï¼šåˆ›å»ºç­–ç•¥æ–‡ä»¶

1. åœ¨ `strategies` æ–‡ä»¶å¤¹ä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶
2. å‘½åä¸º `æˆ‘çš„RSIç­–ç•¥.py`
3. ç”¨ VS Codeã€è®°äº‹æœ¬æˆ–ä»»ä½•æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€

### Step 2ï¼šå†™å…¥åŸºæœ¬æ¡†æ¶

```python
# coding: utf-8
"""
æˆ‘çš„ç¬¬ä¸€ä¸ªç­–ç•¥ï¼šRSI è¶…ä¹°è¶…å–ç­–ç•¥

ç­–ç•¥é€»è¾‘ï¼š
- RSI < 30 æ—¶ä¹°å…¥ï¼ˆè¶…å–ï¼‰
- RSI > 70 æ—¶å–å‡ºï¼ˆè¶…ä¹°ï¼‰
"""
from khQuantImport import *

def init(stocks=None, data=None):
    """ç­–ç•¥åˆå§‹åŒ–"""
    pass

def khHandlebar(data):
    """ç­–ç•¥ä¸»é€»è¾‘"""
    signals = []
    
    # TODO: åœ¨è¿™é‡Œå†™ä½ çš„ç­–ç•¥é€»è¾‘
    
    return signals
```

### Step 3ï¼šè·å–åŸºæœ¬ä¿¡æ¯

åœ¨ `khHandlebar` å‡½æ•°ä¸­æ·»åŠ ï¼š

```python
def khHandlebar(data):
    signals = []
    
    # 1. è·å–åŸºæœ¬ä¿¡æ¯
    stock_code = khGet(data, "first_stock")  # è·å–è‚¡ç¥¨ä»£ç 
    current_price = khPrice(data, stock_code, "open")  # è·å–å¼€ç›˜ä»·
    current_date = khGet(data, "date_num")  # è·å–æ—¥æœŸ
    
    return signals
```

### Step 4ï¼šè®¡ç®— RSI æŒ‡æ ‡

OSkhQuant çš„ `MyTT.py` æä¾›äº† RSI å‡½æ•°ã€‚ä½†ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªè¾…åŠ©æ–¹æ³•ï¼š

```python
def khHandlebar(data):
    signals = []
    
    # 1. è·å–åŸºæœ¬ä¿¡æ¯
    stock_code = khGet(data, "first_stock")
    current_price = khPrice(data, stock_code, "open")
    current_date = khGet(data, "date_num")
    
    # 2. è·å–å†å²æ”¶ç›˜ä»·ï¼ˆç”¨äºè®¡ç®—RSIï¼‰
    framework = khGet(data, "framework")
    closes = framework.get_history_data(stock_code, "close", 20, current_date)
    
    if closes is None or len(closes) < 14:
        return signals  # æ•°æ®ä¸è¶³ï¼Œè·³è¿‡
    
    # 3. è®¡ç®— RSIï¼ˆä½¿ç”¨ MyTT åº“ï¼‰
    from MyTT import RSI
    rsi_values = RSI(closes, 14)
    current_rsi = rsi_values[-1] if len(rsi_values) > 0 else 50
    
    return signals
```

### Step 5ï¼šæ·»åŠ äº¤æ˜“é€»è¾‘

```python
def khHandlebar(data):
    signals = []
    
    # 1. è·å–åŸºæœ¬ä¿¡æ¯
    stock_code = khGet(data, "first_stock")
    current_price = khPrice(data, stock_code, "open")
    current_date = khGet(data, "date_num")
    
    # 2. è·å–å†å²æ•°æ®
    framework = khGet(data, "framework")
    closes = framework.get_history_data(stock_code, "close", 20, current_date)
    
    if closes is None or len(closes) < 14:
        return signals
    
    # 3. è®¡ç®— RSI
    from MyTT import RSI
    rsi_values = RSI(closes, 14)
    current_rsi = rsi_values[-1] if len(rsi_values) > 0 else 50
    
    # 4. æ£€æŸ¥æŒä»“çŠ¶æ€
    has_position = khHas(data, stock_code)
    
    # 5. äº¤æ˜“é€»è¾‘
    if current_rsi < 30 and not has_position:
        # RSI < 30ï¼Œè¶…å–ï¼Œä¹°å…¥
        signals = generate_signal(
            data, stock_code, current_price,
            1.0, 'buy', f"RSI={current_rsi:.1f} è¶…å–ä¹°å…¥"
        )
    
    elif current_rsi > 70 and has_position:
        # RSI > 70ï¼Œè¶…ä¹°ï¼Œå–å‡º
        signals = generate_signal(
            data, stock_code, current_price,
            1.0, 'sell', f"RSI={current_rsi:.1f} è¶…ä¹°å–å‡º"
        )
    
    return signals
```

### å®Œæ•´ç­–ç•¥ä»£ç 

```python
# coding: utf-8
"""
æˆ‘çš„ç¬¬ä¸€ä¸ªç­–ç•¥ï¼šRSI è¶…ä¹°è¶…å–ç­–ç•¥

ç­–ç•¥é€»è¾‘ï¼š
- RSI < 30 æ—¶ä¹°å…¥ï¼ˆè¶…å–ï¼‰
- RSI > 70 æ—¶å–å‡ºï¼ˆè¶…ä¹°ï¼‰
"""
from khQuantImport import *

def init(stocks=None, data=None):
    """ç­–ç•¥åˆå§‹åŒ–"""
    pass

def khHandlebar(data):
    """ç­–ç•¥ä¸»é€»è¾‘"""
    signals = []
    
    # 1. è·å–åŸºæœ¬ä¿¡æ¯
    stock_code = khGet(data, "first_stock")
    current_price = khPrice(data, stock_code, "open")
    current_date = khGet(data, "date_num")
    
    # 2. è·å–å†å²æ•°æ®
    framework = khGet(data, "framework")
    closes = framework.get_history_data(stock_code, "close", 20, current_date)
    
    if closes is None or len(closes) < 14:
        return signals  # æ•°æ®ä¸è¶³ï¼Œè·³è¿‡
    
    # 3. è®¡ç®— RSI
    from MyTT import RSI
    rsi_values = RSI(closes, 14)
    current_rsi = rsi_values[-1] if len(rsi_values) > 0 else 50
    
    # 4. æ£€æŸ¥æŒä»“çŠ¶æ€
    has_position = khHas(data, stock_code)
    
    # 5. äº¤æ˜“é€»è¾‘
    if current_rsi < 30 and not has_position:
        signals = generate_signal(
            data, stock_code, current_price,
            1.0, 'buy', f"RSI={current_rsi:.1f} è¶…å–ä¹°å…¥"
        )
    
    elif current_rsi > 70 and has_position:
        signals = generate_signal(
            data, stock_code, current_price,
            1.0, 'sell', f"RSI={current_rsi:.1f} è¶…ä¹°å–å‡º"
        )
    
    # è°ƒè¯•è¾“å‡ºï¼ˆå¯é€‰ï¼‰
    print(f"{current_date} RSI={current_rsi:.1f} æŒä»“={has_position}")
    
    return signals
```

---

## 6.4 æµ‹è¯•ä½ çš„ç­–ç•¥

### Step 1ï¼šåœ¨ OSkhQuant ä¸­åŠ è½½

1. æ‰“å¼€ OSkhQuant
2. ç‚¹å‡»"é€‰æ‹©ç­–ç•¥æ–‡ä»¶"
3. é€‰æ‹©åˆšæ‰åˆ›å»ºçš„ `æˆ‘çš„RSIç­–ç•¥.py`

### Step 2ï¼šé…ç½®å‚æ•°

- è‚¡ç¥¨æ± ï¼šé€‰æ‹©ä¸€åªè‚¡ç¥¨
- æ—¶é—´èŒƒå›´ï¼šæœ€è¿‘ 3 ä¸ªæœˆ
- æ•°æ®å‘¨æœŸï¼šæ—¥çº¿

### Step 3ï¼šè¡¥å……æ•°æ®

ç¡®ä¿è¡¥å……äº†è¶³å¤Ÿçš„æ—¥çº¿æ•°æ®ã€‚

### Step 4ï¼šè¿è¡Œå›æµ‹

ç‚¹å‡»"å¼€å§‹è¿è¡Œ"ï¼Œè§‚å¯Ÿæ—¥å¿—è¾“å‡ºã€‚

---

## 6.5 è°ƒè¯•æŠ€å·§

### ä½¿ç”¨ print è¾“å‡º

åœ¨ç­–ç•¥ä¸­æ·»åŠ  `print` è¯­å¥ï¼Œå¯ä»¥åœ¨æ—¥å¿—ä¸­çœ‹åˆ°è¾“å‡ºï¼š

```python
print(f"å½“å‰æ—¥æœŸ: {current_date}, RSI: {current_rsi:.2f}")
```

### å¸¸è§é”™è¯¯æ’æŸ¥

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ³• |
|-----|---------|---------|
| æ²¡æœ‰ä»»ä½•äº¤æ˜“ | æ¡ä»¶å¤ªä¸¥æ ¼ | æ”¾å®½é˜ˆå€¼ï¼ˆå¦‚ RSI<35ï¼‰ |
| æŠ¥é”™ï¼šå˜é‡æœªå®šä¹‰ | æ‹¼å†™é”™è¯¯ | æ£€æŸ¥å˜é‡å |
| æŠ¥é”™ï¼šç´¢å¼•è¶Šç•Œ | æ•°æ®ä¸è¶³ | æ·»åŠ æ•°æ®é•¿åº¦æ£€æŸ¥ |
| RSI ä¸€ç›´æ˜¯ 50 | æ•°æ®è·å–å¤±è´¥ | æ£€æŸ¥æ•°æ®æ˜¯å¦è¡¥å…… |

### ç­–ç•¥å¼€å‘æ£€æŸ¥æ¸…å•

```
âœ… ç­–ç•¥æ–‡ä»¶æ£€æŸ¥æ¸…å•ï¼š
â–¡ æ–‡ä»¶ç¼–ç æ˜¯ UTF-8
â–¡ å¯¼å…¥äº† khQuantImport
â–¡ å®šä¹‰äº† khHandlebar å‡½æ•°
â–¡ å‡½æ•°è¿”å› signals åˆ—è¡¨
â–¡ ä¹°å–æ¡ä»¶é€»è¾‘æ­£ç¡®
â–¡ æ·»åŠ äº†æ•°æ®é•¿åº¦æ£€æŸ¥
```

---

## 6.6 ç­–ç•¥ä¼˜åŒ–æ€è·¯

ä¸€ä¸ªç­–ç•¥å†™å®Œåªæ˜¯å¼€å§‹ï¼Œä¼˜åŒ–æ‰æ˜¯å…³é”®ã€‚

### å‚æ•°ä¼˜åŒ–

RSI ç­–ç•¥å¯ä»¥è°ƒæ•´çš„å‚æ•°ï¼š

| å‚æ•° | å½“å‰å€¼ | å¯å°è¯•èŒƒå›´ |
|-----|-------|----------|
| RSI å‘¨æœŸ | 14 | 7-21 |
| ä¹°å…¥é˜ˆå€¼ | 30 | 20-35 |
| å–å‡ºé˜ˆå€¼ | 70 | 65-80 |

### ç­–ç•¥å¢å¼º

1. **æ·»åŠ æ­¢æŸ**
   ```python
   if å½“å‰äºæŸ > 5%:
       å–å‡ºæ­¢æŸ
   ```

2. **æ·»åŠ ç¡®è®¤ä¿¡å·**
   ```python
   if RSI < 30 and ä»·æ ¼ä¸Šæ¶¨:
       ä¹°å…¥ï¼ˆå¢åŠ ç¡®è®¤æ¡ä»¶ï¼‰
   ```

3. **ä»“ä½ç®¡ç†**
   ```python
   if ä¿¡å·å¼ºåº¦é«˜:
       å…¨ä»“ä¹°å…¥
   else:
       åŠä»“è¯•æ¢
   ```

---

## ğŸ’¡ å®è·µä»»åŠ¡

### ä»»åŠ¡ 1ï¼šè¿è¡Œ RSI ç­–ç•¥
- [ ] åˆ›å»º `æˆ‘çš„RSIç­–ç•¥.py` æ–‡ä»¶
- [ ] å¤åˆ¶ä¸Šé¢çš„å®Œæ•´ä»£ç 
- [ ] åœ¨ OSkhQuant ä¸­è¿è¡Œå›æµ‹
- [ ] æŸ¥çœ‹å›æµ‹ç»“æœ

### ä»»åŠ¡ 2ï¼šä¿®æ”¹å‚æ•°
- [ ] æŠŠä¹°å…¥é˜ˆå€¼ä» 30 æ”¹æˆ 25
- [ ] æŠŠå–å‡ºé˜ˆå€¼ä» 70 æ”¹æˆ 75
- [ ] é‡æ–°è¿è¡Œï¼Œå¯¹æ¯”ç»“æœ

### ä»»åŠ¡ 3ï¼šæ·»åŠ è°ƒè¯•ä¿¡æ¯
- [ ] åœ¨ç­–ç•¥ä¸­æ·»åŠ æ›´å¤š print è¯­å¥
- [ ] è¾“å‡ºæ¯æ¬¡äº¤æ˜“çš„è¯¦ç»†ä¿¡æ¯
- [ ] è§‚å¯Ÿæ—¥å¿—ï¼Œç†è§£ç­–ç•¥æ‰§è¡Œè¿‡ç¨‹

### æŒ‘æˆ˜ä»»åŠ¡ï¼šç»„åˆç­–ç•¥
- [ ] å°è¯•æŠŠ RSI å’Œå‡çº¿ç»“åˆ
- [ ] æ¡ä»¶ï¼šRSI < 30 ä¸” 5æ—¥å‡çº¿ > 20æ—¥å‡çº¿ æ—¶ä¹°å…¥
- [ ] æç¤ºï¼šå‚è€ƒåŒå‡çº¿ç­–ç•¥çš„ khMA ç”¨æ³•

---

## ğŸ“Œ æ ¸å¿ƒè¦ç‚¹æ€»ç»“

ä»Šå¤©ä½ å­¦åˆ°äº†ï¼š

1. **ç­–ç•¥å¼€å‘æµç¨‹**ï¼šæ˜ç¡®æ€è·¯ â†’ ç¼–å†™ä»£ç  â†’ å›æµ‹éªŒè¯ â†’ åˆ†æä¼˜åŒ–
2. **ç­–ç•¥ä»£ç ç»“æ„**ï¼š
   - å¯¼å…¥è¯­å¥
   - `init()` å‡½æ•°
   - `khHandlebar()` å‡½æ•°
3. **RSI ç­–ç•¥é€»è¾‘**ï¼š
   - RSI < 30 â†’ è¶…å–ä¹°å…¥
   - RSI > 70 â†’ è¶…ä¹°å–å‡º
4. **è°ƒè¯•æŠ€å·§**ï¼šä½¿ç”¨ print è¾“å‡ºã€æ·»åŠ æ•°æ®æ£€æŸ¥
5. **ä¼˜åŒ–æ–¹å‘**ï¼šå‚æ•°è°ƒæ•´ã€æ·»åŠ æ­¢æŸã€ä»“ä½ç®¡ç†

---

## â¡ï¸ ä¸‹ä¸€è¯¾é¢„å‘Š

**ç¬¬ 7 è¯¾ï¼šå›æµ‹åˆ†æ** ğŸ“ˆ

ç­–ç•¥è·‘å®Œäº†ï¼Œç»“æœåˆ°åº•æ€ä¹ˆçœ‹ï¼Ÿä¸‹ä¸€è¯¾æˆ‘ä»¬å°†ï¼š
- æ·±å…¥è§£è¯»å›æµ‹æŠ¥å‘Šçš„æ¯ä¸ªæŒ‡æ ‡
- å­¦ä¼šåˆ¤æ–­ä¸€ä¸ªç­–ç•¥æ˜¯å¦"çœŸçš„å¥½"
- æŒæ¡é¿å…"è¿‡æ‹Ÿåˆ"çš„æŠ€å·§

è¿™æ˜¯æœ¬ç³»åˆ—çš„æœ€åä¸€è¯¾ï¼Œæˆ‘ä»¬æ¥æ”¶ç½‘ï¼ğŸ£
