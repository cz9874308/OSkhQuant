
# 主界面功能与布局

<cite>
**Referenced Files in This Document**   
- [GUI.py](file://GUI.py)
- [GUIkhQuant.py](file://GUIkhQuant.py)
- [khFrame.py](file://khFrame.py)
- [khConfig.py](file://khConfig.py)
</cite>

## 目录
1. [主界面整体布局](#主界面整体布局)
2. [核心功能区域详解](#核心功能区域详解)
3. [主界面与模块的集成与协调](#主界面与模块的集成与协调)
4. [用户操作流程示例](#用户操作流程示例)
5. [主界面与核心引擎的通信机制](#主界面与核心引擎的通信机制)
6. [常见问题排查建议](#常见问题排查建议)

## 主界面整体布局

看海量化回测系统的主界面（`GUIkhQuant.py`）采用现代化的深色主题设计，旨在为用户提供清晰、高效的操作体验。其整体布局遵循“左配置、中控制、右日志”的经典三栏式结构，通过`QSplitter`实现各面板的灵活伸缩。

界面顶部是**菜单栏**，提供文件操作（加载/保存配置）、系统设置和帮助文档等全局功能。紧随其后的是**工具栏**，它集成了最常用的操作按钮，如“加载配置”、“保存配置”、“开始运行”、“停止运行”等，极大地提升了操作效率。工具栏右侧还集成了“本地数据管理”、“定时补充数据”等快捷入口，方便用户快速访问相关功能模块。

主界面的核心由三个垂直排列的面板构成：
1.  **左侧配置面板**：负责策略和回测的所有参数设置。
2.  **中间控制面板**：提供触发方式、实盘数据获取模式和账户信息的配置。
3.  **右侧日志面板**：实时显示系统运行日志。

界面底部是**状态栏**，它包含一个状态指示灯（用于显示MiniQMT客户端的连接状态）、一个用于显示“就绪”等状态信息的标签，以及一个在回测运行时显示进度的进度条。

**Section sources**
- [GUIkhQuant.py](file://GUIkhQuant.py#L1000-L1500)

## 核心功能区域详解

### 策略配置区

位于左侧面板，是用户定义回测任务的起点。
*   **策略文件选择**：用户通过“选择策略文件”按钮，从`strategies`目录中选择一个Python策略文件（如`RSI策略.py`）。
*   **运行模式**：界面固定为“回测”模式，无需用户选择。
*   **股票池设置**：用户可以通过勾选“上证50”、“沪深300”等常用股票池，或在下方的表格中手动添加、导入自定义股票代码，来构建回测的股票列表。

### 回测控制区

同样位于左侧面板，用于设定回测的具体参数。
*   **回测时间设置**：通过`NoWheelDateEdit`控件选择回测的起始日期和结束日期。
*   **基准合约**：输入一个基准指数代码（如`sh.000300`），用于计算策略的相对收益。
*   **交易成本设置**：可配置最低佣金、佣金比例、卖出印花税、流量费以及滑点（支持按“最小变动价跳数”或“成交金额比例”两种模式）。
*   **数据设置**：选择数据的“周期类型”（tick, 1m, 5m, 1d）和“复权方式”（前复权、后复权等），并勾选需要加载的数据字段。

### 触发方式设置区

位于中间面板，决定了策略的执行频率。
*   **触发类型**：提供“Tick触发”、“1分钟K线触发”、“5分钟K线触发”、“日K线触发”和“自定义定时触发”五种选项。
*   **自定义定时触发**：当选择此模式时，用户可以在文本框中输入多个时间点（如`09:30:00`），或使用下方的“时间点生成器”批量生成交易时段内的触发时间。

### 账户信息区

位于中间面板，用于配置虚拟账户的初始状态。
*   **初始资金**：设置回测的起始资金，默认为100万元。
*   **最小交易量**：设置单笔交易的最小股数。

### 日志输出区

位于右侧面板，是用户监控系统运行状态的主要窗口。
*   **日志文本框**：以不同颜色（如白色为INFO，红色为ERROR）实时显示系统日志、策略输出和交易信息。
*   **日志过滤**：通过复选框可以过滤显示`DEBUG`、`INFO`、`WARNING`、`ERROR`和`TRADE`等不同级别的日志。
*   **操作按钮**：提供“清空日志”、“保存日志”和“测试日志”等功能。当回测完成后，会激活“打开回测指标”按钮，用于查看详细的回测报告。

**Section sources**
- [GUIkhQuant.py](file://GUIkhQuant.py#L1500-L2500)

## 主界面与模块的集成与协调

主界面`KhQuantGUI`类作为整个系统的控制中心，通过`GUIkhQuant.py`文件协调并集成其他核心模块。

*   **启动回测**：当用户点击“开始运行”按钮时，主界面会调用`start_strategy`方法。该方法首先通过`update_config`函数收集所有UI上的配置信息，并将其保存为一个临时的`.kh`配置文件。随后，它会创建一个`StrategyThread`线程，并将配置文件路径和策略文件路径传递